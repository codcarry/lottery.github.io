<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .container {
            background-color: #f00000;
            padding-bottom: 20vw;
            /* padding: 2vw; */
            margin: 2vw 4vw 0;
            animation: container-bling 2s infinite alternate;
            border-radius: 1.5%;
            overflow: hidden;
        }

        @keyframes container-bling {
            from {
                box-shadow: 0 0 2vw rgb(198, 195, 15);
            }

            to {
                box-shadow: 0 0 8vw rgb(255, 196, 0);
            }
        }

        .title {
            text-align: center;
            font-size: 3vw;
            color: gold;
            font-weight: 700;
            margin: 1vw 0 0;
        }

        .lottery-item-box {
            padding: 1vw 1vw 4vw;
        }

        .lottery-item-box:nth-last-child(1) {
            border-top: 4px dashed #726666c5;
        }

        .double-color-balls {
            display: flex;
            box-sizing: border-box;
            width: 100%;
            padding: 12px;
        }

        /* .double-color-balls [class^="red-"] {
            background-color: #fa4e4e;
        } */
        @keyframes ball-bling {
            from {
                box-shadow: 0 0 2vw goldenrod;
            }

            to {
                box-shadow: 0 0 8vw gold;
            }
        }

        .ball {
            flex: 1;
            padding: .8vw;
            aspect-ratio: 1;
            border-radius: 50%;
            font-size: 4vw;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-weight: 700;
            margin-right: 3vw;
            animation: ball-bling 2s infinite alternate;
        }

        .blue {
            background-color: #4788f4;
        }


        .options-btns {
            display: flex;
            margin-top: 2vw;
        }

        .do-lottery-btn {
            padding: 2vw;
            flex: 1;
            margin: 0 2vw;
            height: 3vw;
            background-color: gold;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: .4vw;
            cursor: pointer;
            color: red;
            font-weight: 700;
            font-size: 2vw;
        }

        .do-lottery-stop {
            background-color: #f56c6c;
            color: #fff;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="top-animation-god-bless">

        </div>
        <div class="lottery-item-box double-color-box">
            <div class="title">双色球</div>
            <div class="double-color-balls">
                <div class="red-1 ball">8</div>
                <div class="red-2 ball">8</div>
                <div class="red-3 ball">8</div>
                <div class="red-4 ball">8</div>
                <div class="red-5 ball">8</div>
                <div class="red-6 ball">8</div>
                <div class="blue ball">8</div>
            </div>
            <div class="options-btns">
                <div class="do-lottery-btn do-lottery-sudden-double">点击瞬间摇号</div>
                <div class="do-lottery-btn do-lottery-duration-double">点击持续摇号</div>
                <div class="do-lottery-btn do-lottery-stop do-lottery-stop-double">停止摇号</div>
            </div>
        </div>
        <div class="lottery-item-box pailie-box">
            <div class="title">排列三</div>
            <div class="double-color-balls">
                <div class="pailie3 ball">8</div>
                <div class="pailie3 ball">8</div>
                <div class="pailie3 ball">8</div>
                <div class="pailie3 ball" style="opacity: 0;">8</div>
                <div class="pailie3 ball" style="opacity: 0;">8</div>
            </div>
            <div class="title">排列五</div>
            <div class="double-color-balls">
                <div class="pailie5 ball">8</div>
                <div class="pailie5 ball">8</div>
                <div class="pailie5 ball">8</div>
                <div class="pailie5 ball">8</div>
                <div class="pailie5 ball">8</div>
            </div>
            <div class="options-btns">
                <div class="do-lottery-btn do-lottery-sudden-pailie">点击瞬间摇号</div>
                <div class="do-lottery-btn do-lottery-duration-pailie">点击持续摇号</div>
                <div class="do-lottery-btn do-lottery-stop do-lottery-stop-pailie">停止摇号</div>
            </div>
        </div>
    </div>
    <script>
        class DoubleColorBall {
            isLotterying = false
            redList = Array(32).fill(1).map((item, i) => i + 1)
            blueList = Array(16).fill(1).map((item, i) => i + 1)
            duration = 2000
            startTime = 0
            lotteryTimer = null
            redDomList
            blueBall
            constructor(redBallsCommonSelector, blueBallSelector, duration) {
                this.redDomList = document.querySelectorAll(redBallsCommonSelector)
                this.blueBall = document.querySelector(blueBallSelector)
                this.duration = duration || this.duration

            }
            doLottery() {
                console.time('once')
                if (this.isLotterying) return
                this.isLotterying = true
                const taskQueue = []
                const funcs = []
                this.redDomList.forEach((item, index) => {
                    funcs.push(() => {
                        const promiseItem = new Promise((resolve) => {
                            // [0,32)  能取得就是0-31
                            const rdm = Math.floor(Math.random() * this.redList.length)
                            item.innerText = this.redList[rdm]
                            this.redList.splice(rdm, 1)
                            window.requestAnimationFrame(resolve)
                        })
                        taskQueue.push(promiseItem)
                        return promiseItem
                    })
                })
                funcs.push(() => {
                    const promiseItem = new Promise((resolve) => {
                        const rdm = Math.floor(Math.random() * this.blueList.length)
                        this.blueBall.innerText = this.blueList[rdm]
                        window.requestAnimationFrame(resolve)
                    })
                    taskQueue.push(promiseItem)
                    return promiseItem
                })
                funcs.forEach(async item => {
                    await item()
                })
                Promise.allSettled(taskQueue).then(() => {
                    this.isLotterying = false
                    console.timeEnd('once')
                    this.redList = Array(32).fill(1).map((item, i) => i + 1)
                })
            }
            doLotteryWithDuration() {
                !this.startTime && (this.startTime = Date.now())
                this.lotteryTimer = setInterval(() => {
                    if (Date.now() - this.startTime < this.duration) {
                        this.doLottery()
                    } else {
                        this.startTime = 0
                        window.clearInterval(this.lotteryTimer)
                    }
                }, 60);
            }
            stopLottery() {
                this.startTime = 0
                this.lotteryTimer && window.clearInterval(this.lotteryTimer)
            }
            selectDom(domSelector, all = false) {
                return document[all ? 'querySelectorAll' : 'querySelector'](domSelector)
            }
            bindingSudden(suddenBtnSelector) {
                this.selectDom(suddenBtnSelector)
                    .addEventListener('click', this.doLottery.bind(this))
                return this
            }
            bindingDuration(durationBtnSelector) {
                this.selectDom(durationBtnSelector)
                    .addEventListener('click', this.doLotteryWithDuration.bind(this))
                return this
            }
            bindingStop(stopBtnSelector) {
                this.selectDom(stopBtnSelector)
                    .addEventListener('click', this.stopLottery.bind(this))
                return this
            }
        }

        new DoubleColorBall('div[class^="red-"]', '.blue')
            .bindingSudden('.do-lottery-sudden-double')
            .bindingDuration('.do-lottery-duration-double')
            .bindingStop('.do-lottery-stop-double')

        // 每种玩法分开 封装相应的函数  函数对应接受 dom选择器  以及其他一些参数 

        class Permutation {
            ballList3
            ballList5
            startTime = 0
            duration = 2000
            isLotterying = false
            currentLotteryResult = []
            constructor({ ballPermutation3Selector, ballPermutation5Selector, duration }) {
                ballPermutation3Selector && (this.ballList3 = this.selectDom(ballPermutation3Selector, true))
                ballPermutation5Selector && (this.ballList5 = this.selectDom(ballPermutation5Selector, true))
                duration && (this.duration = duration)
            }
            getRandomNum() {
                return Math.floor(10 * Math.random())
            }
            doLottery() {
                if (this.isLotterying) return
                this.isLotterying = true
                const funcs = []
                const taskQueue = []
                this.ballList5.forEach((item, i) => {
                    funcs.push(() => {
                        const promiseItem = new Promise((resolve) => {
                            const randomNum = this.getRandomNum()
                            this.currentLotteryResult.push(randomNum)
                            item.innerText = randomNum
                            if (i < 3) {
                                this.ballList3[i].innerText = randomNum
                            }
                            window.requestAnimationFrame(resolve)
                        })
                        taskQueue.push(promiseItem)
                        return promiseItem
                    })
                    funcs.forEach(async item => {
                        await item()
                    })
                    Promise.allSettled(taskQueue)
                        .then(() => {
                            this.isLotterying = false
                        })
                })
            }
            doLotteryWithDuration() {
                !this.startTime && (this.startTime = Date.now())
                this.lotteryTimer = setInterval(() => {
                    if (Date.now() - this.startTime < this.duration) {
                        this.doLottery()
                    } else {
                        this.startTime = 0
                        window.clearInterval(this.lotteryTimer)
                    }
                }, 60);
            }
            stopLottery() {
                this.startTime = 0
                this.lotteryTimer && window.clearInterval(this.lotteryTimer)
            }
            selectDom(domSelector, all = false) {
                return document[all ? 'querySelectorAll' : 'querySelector'](domSelector)
            }
            bindingSudden(suddenBtnSelector) {
                this.selectDom(suddenBtnSelector)
                    .addEventListener('click', this.doLottery.bind(this))
                return this
            }
            bindingDuration(durationBtnSelector) {
                this.selectDom(durationBtnSelector)
                    .addEventListener('click', this.doLotteryWithDuration.bind(this))
                return this
            }
            bindingStop(stopBtnSelector) {
                this.selectDom(stopBtnSelector)
                    .addEventListener('click', this.stopLottery.bind(this))
                return this
            }
        }
        new Permutation({
            ballPermutation3Selector: '.pailie3',
            ballPermutation5Selector: '.pailie5',
            duration: 20000
        })
            .bindingSudden('.do-lottery-sudden-pailie')
            .bindingDuration('.do-lottery-duration-pailie')
            .bindingStop('.do-lottery-stop-pailie')
    </script>
</body>

</html>